# –ü—Ä–æ–º–ø—Ç –¥–ª—è AI-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–µ—Ä–º—ã –∞–ª—å–ø–∞–∫ –õ—É–õ—É

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–°–æ–∑–¥–∞–π –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø–ª–∞—Ç—ã —ç–∫—Å–∫—É—Ä—Å–∏–π –Ω–∞ —Ñ–µ—Ä–º—É –∞–ª—å–ø–∞–∫ –õ—É–õ—É (https://lulu-alpaca.ru/) –¥–ª—è —Ö–∞–∫–∞—Ç–æ–Ω–∞.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Frontend:**
- Next.js 14+ (App Router)
- React 18+
- TypeScript
- Tailwind CSS
- shadcn/ui –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- React Hook Form + Zod –¥–ª—è —Ñ–æ—Ä–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- Axios –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

**Backend:**
- Node.js 18+ —Å Express.js
- TypeScript
- Prisma ORM
- PostgreSQL 15+

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- AmoCRM API v4 (—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, —Å–¥–µ–ª–æ–∫, —Å–æ–±—ã—Ç–∏—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ)
- PayKeeper API (–ø—Ä–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π)
- Nodemailer (–æ—Ç–ø—Ä–∞–≤–∫–∞ email)

## –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å)

**–®–∞–≥ 1: –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—Ç–∞:
  - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
  - "–°–≤–æ–±–æ–¥–Ω–æ X –º–µ—Å—Ç –∏–∑ Y"
  - –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è (–∑–µ–ª–µ–Ω—ã–π - –º–Ω–æ–≥–æ –º–µ—Å—Ç, –∂–µ–ª—Ç—ã–π - –º–∞–ª–æ, —Å–µ—Ä—ã–π - –∑–∞–Ω—è—Ç–æ)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω —Å–ª–æ—Ç

**–®–∞–≥ 2: –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
```typescript
interface BookingForm {
  // –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
  name: string;
  phone: string; // —Ñ–æ—Ä–º–∞—Ç +7 (XXX) XXX-XX-XX
  email: string;
  
  // –ë–∏–ª–µ—Ç—ã
  tickets: {
    adult: number;    // –≤–∑—Ä–æ—Å–ª—ã–π (0-10)
    child: number;    // –¥–µ—Ç—Å–∫–∏–π (0-10)
    infant: number;   // –¥–æ 3 –ª–µ—Ç, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π (0-10)
  };
  
  // –°–æ–≥–ª–∞—Å–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
  agreements: {
    offerAccepted: boolean;
    personalDataAccepted: boolean;
  };
}
```

- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—É–º–º—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π

**–®–∞–≥ 3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**
- –°–≤–æ–¥–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"

**–®–∞–≥ 4: –û–ø–ª–∞—Ç–∞**
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ PayKeeper –¥–ª—è –æ–ø–ª–∞—Ç—ã
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email (—á–µ–∫, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –ø–∞–º—è—Ç–∫–∞)

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å":
1. –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –≤ AmoCRM (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, email)
2. –°–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É –≤ —ç—Ç–∞–ø–µ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ" —Å –ø–æ–ª—è–º–∏:
   - –ë—é–¥–∂–µ—Ç: —Å—É–º–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –í–∑—Ä–æ—Å–ª—ã–µ –±–∏–ª–µ—Ç—ã: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
   - –î–µ—Ç—Å–∫–∏–µ –±–∏–ª–µ—Ç—ã: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
   - –î–µ—Ç—Å–∫–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –±–∏–ª–µ—Ç—ã: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
   - –î–∞—Ç–∞ —ç–∫—Å–∫—É—Ä—Å–∏–∏: –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–ª–æ—Ç–∞
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É PayKeeper
3. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å AmoCRM (—Å—Ç–∞—Ç—É—Å "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ")

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ (webhook –æ—Ç PayKeeper):
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏ –≤ AmoCRM –Ω–∞ "–û–ø–ª–∞—á–µ–Ω–æ"
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –Ω–∞ "–û–ø–ª–∞—á–µ–Ω–æ"

### 3. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–∞–º–∏:**
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–ª–æ—Ç–æ–≤
- –ü–æ–ª—è: –¥–∞—Ç–∞, –≤—Ä–µ–º—è, –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç, —Ç–∞—Ä–∏—Ñ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–ª–æ—Ç–æ–≤

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞–º–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ü–µ–Ω–∞–º–∏ (–≤–∑—Ä–æ—Å–ª—ã–π, –¥–µ—Ç—Å–∫–∏–π, –¥–µ—Ç—Å–∫–∏–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
- –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:
  - –ü–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–æ–º–æ" –ø–æ –±—É–¥–Ω—è–º, "–°—Ç–∞–Ω–¥–∞—Ä—Ç" –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º)
  - –ü–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–∞—Ç–∞–º
  - –ü–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–ª–æ—Ç–∞–º
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (—Ç–∞–±–ª–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É
- –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º –º–µ—Å—Ç)

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Prisma Schema)

```prisma
model User {
  id               String    @id @default(uuid())
  name             String
  phone            String
  email            String
  amocrmContactId  Int?
  bookings         Booking[]
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model Tariff {
  id          String    @id @default(uuid())
  name        String
  adultPrice  Decimal   @db.Decimal(10, 2)
  childPrice  Decimal   @db.Decimal(10, 2)
  infantPrice Decimal   @db.Decimal(10, 2) @default(0)
  description String?
  isActive    Boolean   @default(true)
  slots       Slot[]
  schedules   TariffSchedule[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Slot {
  id                String    @id @default(uuid())
  date              DateTime  @db.Date
  time              DateTime  @db.Time
  totalCapacity     Int
  availableCapacity Int
  tariffId          String
  tariff            Tariff    @relation(fields: [tariffId], references: [id])
  status            SlotStatus @default(ACTIVE)
  bookings          Booking[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

enum SlotStatus {
  ACTIVE
  BLOCKED
  FULL
}

model Booking {
  id            String        @id @default(uuid())
  userId        String
  user          User          @relation(fields: [userId], references: [id])
  slotId        String
  slot          Slot          @relation(fields: [slotId], references: [id])
  adultTickets  Int
  childTickets  Int
  infantTickets Int
  totalAmount   Decimal       @db.Decimal(10, 2)
  status        BookingStatus @default(PENDING)
  paymentLink   String?
  paymentId     String?
  amocrmDealId  Int?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  confirmedAt   DateTime?
  paidAt        DateTime?
}

enum BookingStatus {
  PENDING
  CONFIRMED
  PAID
  CANCELLED
}

model TariffSchedule {
  id           String    @id @default(uuid())
  tariffId     String
  tariff       Tariff    @relation(fields: [tariffId], references: [id])
  dayOfWeek    DayOfWeek?
  specificDate DateTime? @db.Date
  timeFrom     DateTime? @db.Time
  timeTo       DateTime? @db.Time
  priority     Int       @default(0)
  createdAt    DateTime  @default(now())
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}
```

### 5. API Endpoints

**–ü—É–±–ª–∏—á–Ω—ã–µ:**
```
GET    /api/slots?date_from=2024-01-01&date_to=2024-01-31
GET    /api/slots/:id
POST   /api/bookings
POST   /api/payments/webhook (PayKeeper webhook)
```

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏):**
```
GET    /api/admin/bookings
PATCH  /api/admin/bookings/:id
POST   /api/admin/bookings/:id/regenerate-payment
POST   /api/admin/slots
GET    /api/admin/slots
PATCH  /api/admin/slots/:id
DELETE /api/admin/slots/:id
GET    /api/admin/tariffs
POST   /api/admin/tariffs
PATCH  /api/admin/tariffs/:id
```

### 6. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lulu-booking/
‚îú‚îÄ‚îÄ frontend/                 # Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ thank-you/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx     # –ê–¥–º–∏–Ω –¥–∞—à–±–æ—Ä–¥
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ slots/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookings/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tariffs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/             # API Routes (Next.js API)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ slots/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ bookings/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Calendar.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookingForm.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SlotCard.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ amocrm.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ paykeeper.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ email.ts
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

## –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–π TypeScript –≤–µ–∑–¥–µ
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** Zod —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ä–º –∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** Try-catch –±–ª–æ–∫–∏, –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
4. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î:** –ü—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Prisma
5. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ
6. **Loading states:** –°–∫–µ–ª–µ—Ç–æ–Ω—ã –∏ –ª–æ–∞–¥–µ—Ä—ã –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
7. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ UI:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ü—Ä–∏–º–µ—Ä—ã –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (backend)

```typescript
async function createBooking(data: BookingInput) {
  return await prisma.$transaction(async (tx) => {
    // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞
    const slot = await tx.slot.findUnique({ where: { id: data.slotId } });
    const totalTickets = data.tickets.adult + data.tickets.child + data.tickets.infant;
    
    if (slot.availableCapacity < totalTickets) {
      throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç');
    }
    
    // 2. –°–æ–∑–¥–∞—Ç—å/–Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = await tx.user.upsert({
      where: { email: data.user.email },
      update: { name: data.user.name, phone: data.user.phone },
      create: data.user
    });
    
    // 3. –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    const booking = await tx.booking.create({
      data: {
        userId: user.id,
        slotId: data.slotId,
        adultTickets: data.tickets.adult,
        childTickets: data.tickets.child,
        infantTickets: data.tickets.infant,
        totalAmount: calculateTotal(slot.tariff, data.tickets)
      }
    });
    
    // 4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞
    await tx.slot.update({
      where: { id: data.slotId },
      data: { availableCapacity: { decrement: totalTickets } }
    });
    
    // 5. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –∏ —Å–¥–µ–ª–∫—É –≤ AmoCRM
    const amocrmContact = await createAmoCRMContact(user);
    const amocrmDeal = await createAmoCRMDeal({
      contact: amocrmContact,
      booking,
      slot
    });
    
    // 6. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É PayKeeper
    const paymentLink = await createPayKeeperPayment({
      orderId: booking.id,
      amount: booking.totalAmount,
      customer: user
    });
    
    // 7. –û–±–Ω–æ–≤–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ AmoCRM –∏ PayKeeper
    return await tx.booking.update({
      where: { id: booking.id },
      data: {
        amocrmDealId: amocrmDeal.id,
        paymentLink
      }
    });
  });
}
```

### –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–ª–æ—Ç–æ–≤ (frontend)

```tsx
'use client';

import { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { Calendar } from '@/components/ui/calendar';
import { SlotCard } from '@/components/SlotCard';

export function BookingCalendar() {
  const [selectedDate, setSelectedDate] = useState<Date>(new Date());
  
  const { data: slots, isLoading } = useQuery({
    queryKey: ['slots', selectedDate],
    queryFn: () => fetchSlots(selectedDate)
  });
  
  return (
    <div className="grid md:grid-cols-2 gap-8">
      <Calendar
        mode="single"
        selected={selectedDate}
        onSelect={setSelectedDate}
        className="rounded-md border"
      />
      
      <div className="space-y-4">
        <h3 className="text-lg font-semibold">
          –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –Ω–∞ {format(selectedDate, 'dd MMMM yyyy', { locale: ru })}
        </h3>
        
        {isLoading ? (
          <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        ) : slots?.length === 0 ? (
          <p className="text-muted-foreground">–ù–∞ —ç—Ç—É –¥–∞—Ç—É –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤</p>
        ) : (
          slots?.map(slot => (
            <SlotCard 
              key={slot.id} 
              slot={slot} 
              onSelect={() => handleSlotSelect(slot)}
            />
          ))
        )}
      </div>
    </div>
  );
}
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.example)

```env
# Database
DATABASE_URL="postgresql://postgres:password@localhost:5432/lulu_booking"

# AmoCRM
AMOCRM_CLIENT_ID="your-client-id"
AMOCRM_CLIENT_SECRET="your-client-secret"
AMOCRM_REDIRECT_URI="http://localhost:3000/api/amocrm/callback"
AMOCRM_SUBDOMAIN="your-subdomain"
AMOCRM_ACCESS_TOKEN="your-access-token"
AMOCRM_REFRESH_TOKEN="your-refresh-token"

# PayKeeper
PAYKEEPER_SERVER="your-server.server.paykeeper.ru"
PAYKEEPER_SECRET="your-secret"
PAYKEEPER_USER="your-user"
PAYKEEPER_PASSWORD="your-password"

# Email
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="your-email@gmail.com"
SMTP_PASSWORD="your-app-password"
EMAIL_FROM="noreply@lulu-alpaca.ru"

# App
NEXT_PUBLIC_APP_URL="http://localhost:3000"
JWT_SECRET="your-jwt-secret-for-admin"
```

## Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
      POSTGRES_DB: lulu_booking
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  app:
    build: .
    ports:
      - "3000:3000"
    depends_on:
      - postgres
    environment:
      DATABASE_URL: postgresql://postgres:password@postgres:5432/lulu_booking
    volumes:
      - .:/app
      - /app/node_modules

volumes:
  postgres_data:
```

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL —á–µ—Ä–µ–∑ Docker
docker-compose up -d postgres

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev

# 5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
npx prisma db seed

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –¥–ª—è —Ö–∞–∫–∞—Ç–æ–Ω–∞

‚úÖ **Must Have:**
- –†–∞–±–æ—Ç–∞—é—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –§–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ë–î
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PayKeeper (—Ö–æ—Ç—è –±—ã —Ç–µ—Å—Ç–æ–≤–∞—è)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AmoCRM (—Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫)
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ë–∞–∑–æ–≤–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

‚úÖ **Should Have:**
- –°–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ–æ–≤
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Loading states

üéÅ **Nice to Have:**
- –ü–æ–ª–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- E2E —Ç–µ—Å—Ç—ã
- Production deployment

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

1. **–î–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è:** –ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É `react-day-picker` –∏–ª–∏ `@fullcalendar/react`
2. **–î–ª—è —Ñ–æ—Ä–º:** React Hook Form –æ—á–µ–Ω—å —É–¥–æ–±–Ω–∞ —Å Zod
3. **–î–ª—è —Ç–∞–±–ª–∏—Ü –≤ –∞–¥–º–∏–Ω–∫–µ:** `@tanstack/react-table`
4. **–î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** `sonner` –∏–ª–∏ `react-hot-toast`
5. **–î–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω:** `@radix-ui/react-dialog` (–≤—Ö–æ–¥–∏—Ç –≤ shadcn/ui)

**–ù–∞—á–Ω–∏ —Å:**
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Next.js –ø—Ä–æ–µ–∫—Ç–∞ —Å TypeScript
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Prisma –∏ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
3. –°–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å–ª–æ—Ç–æ–≤
4. API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤
5. –§–æ—Ä–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–£–¥–∞—á–∏! ü¶ô**
